# Contribution

Development happens on separate branches, then a pull-request is opened in order to contribute back the changes to master branch.

## Building
Gradle is used for build and dependency management. Gradle wrapper is added to Cloudbreak git repository, therefore building can be done with:
```
./gradlew clean build
```

## Local Development Setup
To use this development environment on OSX, you need to have Docker and Boot2docker installed.

### Cloudbreak Deployer

Simplest way to prepare the working environment is to start the Cloudbreak on your local machine is to use the [Cloudbreak Deployer](https://github.com/sequenceiq/cloudbreak-deployer).

```
# shall be executed outside of git repository
mkdir cbd-local
cd cbd-local
curl https://raw.githubusercontent.com/sequenceiq/cloudbreak-deployer/master/install | sh && cbd --version
cbd update master
cbd init
cbd start
```
If everything went well then the Cloudbreak will be available on http://192.168.59.103:3000. For more details and config parameters please check the documentation of [Cloudbreak Deployer](https://github.com/sequenceiq/cloudbreak-deployer).

The deployer has generated a `certs` directory under `cbd-local` directory which will be needed

### IDEA

To set up the proper code formatter for IDEA please use the __File -> Import Settings...__ menu to import the idea_settings.jar located in the Cloudbreak git repository.

To launch the Cloudbreak application execute the `com.sequenceiq.cloudbreak.CloudbreakApplication` class with VM options:
```
-XX:MaxPermSize=1024m
-Dcb.cert.dir=FULL_PATH_OF_THE_CERTS_DIR_GENERATED_BY_CBD
-Dcb.client.id=cloudbreak
-Dcb.client.secret=cbsecret2015
-Dcb.db.port.5432.tcp.addr=192.168.59.103
-Dcb.db.port.5432.tcp.port=5432
-Dcb.identity.server.url=http://192.168.59.103:8089
-Dserver.port=9091
```

The `-Dcb.cert.dir=FULL_PATH_OF_THE_CERTS_DIR_GENERATED_BY_CBD` value above needs to be replaced with the full path of `certs` directory generated by Cloudbreak Deployer e.g. `-Dcb.cert.dir=/Users/myusername/prj/cbd-local/certs`

Once the Cloudbreak is started in IDEA you can switch back to command line and execute the following command in `cbd-local` directory
```
cbd util local-dev
```
This command will kill the Cloudbreak container running inside the boot2docker and redirect the Cloudbreak related traffic to the Cloudbreak running in IDEA.
